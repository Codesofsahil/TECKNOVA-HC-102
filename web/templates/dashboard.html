<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Platform - Security Operations Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: all 0.3s ease;
        }
        
        /* Light Mode Styles */
        body.light-mode {
            background: linear-gradient(-45deg, #f8fafc, #e2e8f0, #cbd5e1, #94a3b8, #64748b);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        body.light-mode .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        
        body.light-mode .glass-strong {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        body.light-mode .text-white { color: #1f2937 !important; }
        body.light-mode .text-gray-300 { color: #4b5563 !important; }
        body.light-mode .text-gray-400 { color: #6b7280 !important; }
        
        .gradient-bg { 
            background: linear-gradient(-45deg, #0f172a, #1e293b, #334155, #0c4a6e, #1e3a8a); 
            background-size: 400% 400%; 
            animation: gradientShift 20s ease infinite; 
        }
        
        @keyframes gradientShift { 
            0%, 100% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
        }
        
        .glass { 
            background: rgba(255, 255, 255, 0.06); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass:hover { 
            background: rgba(255, 255, 255, 0.08); 
            border-color: rgba(255, 255, 255, 0.18);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5);
        }
        
        .glass-strong { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        
        @keyframes pulse { 
            0%, 100% { opacity: 1; transform: scale(1); } 
            50% { opacity: 0.6; transform: scale(1.1); } 
        }
        
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .stat-card:hover::before {
            left: 100%;
        }
        
        .nav-btn {
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }
        
        .nav-btn.active::after {
            width: 80%;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.6), rgba(96, 165, 250, 0.6)); 
            border-radius: 10px; 
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #3b82f6, #60a5fa); }
        
        .alert-card, .log-entry {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .alert-card:hover, .log-entry:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .severity-critical { border-left-color: #ef4444 !important; }
        .severity-high { border-left-color: #f97316 !important; }
        .severity-medium { border-left-color: #eab308 !important; }
        .severity-low { border-left-color: #3b82f6 !important; }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            animation: slideInRight 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            padding: 20px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            to { left: 100%; }
        }
        
        .notification.critical {
            border-left: 4px solid #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
        }
        
        .notification.high {
            border-left: 4px solid #f97316;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(234, 88, 12, 0.1));
        }
        
        .notification.medium {
            border-left: 4px solid #eab308;
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(202, 138, 4, 0.1));
        }
        
        .notification.info {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
        }
        
        @keyframes slideInRight {
            from { transform: translateX(400px) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(400px) scale(0.8); opacity: 0; }
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-critical { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .badge-high { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }
        .badge-medium { background: linear-gradient(135deg, #eab308, #ca8a04); color: white; }
        .badge-low { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        
        select, input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        button {
            transition: all 0.3s ease;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        table tbody tr {
            transition: all 0.2s ease;
        }
        
        table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: scale(1.01);
        }
        
        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            animation: float 25s infinite linear;
        }
        
        .shape:nth-child(1) { width: 60px; height: 60px; left: 5%; animation-delay: 0s; background: rgba(59, 130, 246, 0.15); }
        .shape:nth-child(2) { width: 80px; height: 80px; left: 15%; animation-delay: 3s; background: rgba(139, 92, 246, 0.12); }
        .shape:nth-child(3) { width: 40px; height: 40px; left: 65%; animation-delay: 6s; background: rgba(16, 185, 129, 0.1); }
        .shape:nth-child(4) { width: 70px; height: 70px; left: 85%; animation-delay: 9s; background: rgba(239, 68, 68, 0.08); }
        .shape:nth-child(5) { width: 90px; height: 90px; left: 45%; animation-delay: 12s; background: rgba(245, 158, 11, 0.1); }
        .shape:nth-child(6) { width: 50px; height: 50px; left: 25%; animation-delay: 15s; background: rgba(99, 102, 241, 0.12); }
        .shape:nth-child(7) { width: 65px; height: 65px; left: 75%; animation-delay: 18s; background: rgba(236, 72, 153, 0.1); }
        
        /* Light mode floating shapes */
        body.light-mode .shape:nth-child(1) { background: rgba(30, 64, 175, 0.2); }
        body.light-mode .shape:nth-child(2) { background: rgba(91, 33, 182, 0.18); }
        body.light-mode .shape:nth-child(3) { background: rgba(5, 150, 105, 0.15); }
        body.light-mode .shape:nth-child(4) { background: rgba(185, 28, 28, 0.12); }
        body.light-mode .shape:nth-child(5) { background: rgba(180, 83, 9, 0.15); }
        body.light-mode .shape:nth-child(6) { background: rgba(67, 56, 202, 0.18); }
        body.light-mode .shape:nth-child(7) { background: rgba(190, 24, 93, 0.15); }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>
    
    <div class="container mx-auto p-6 custom-scrollbar" style="max-height: 100vh; overflow-y: auto; position: relative; z-index: 1;">
        <!-- Header -->
        <header class="glass-strong rounded-2xl p-6 mb-6 fade-in">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white tracking-tight">SOC Platform</h1>
                        <p class="text-sm text-gray-300">Security Operations Center</p>
                    </div>
                </div>
                <div class="flex items-center gap-6 text-white">
                    <button id="darkModeToggle" onclick="toggleDarkMode()" class="glass px-4 py-2 rounded-xl hover:bg-white/10 transition-all flex items-center gap-2" title="Toggle Dark/Light Mode">
                        <svg id="darkModeIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                        </svg>
                        <span id="darkModeText">Dark</span>
                    </button>
                    <button onclick="logout()" class="glass px-4 py-2 rounded-xl hover:bg-white/10 transition-all flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Logout
                    </button>
                    <button onclick="alert('Test popup clicked!'); var div = document.createElement('div'); div.innerHTML = 'üö® POPUP WORKING!'; div.style.cssText = 'position:fixed;top:20px;right:20px;background:red;color:white;padding:20px;z-index:99999;border-radius:10px;'; document.body.appendChild(div); setTimeout(function(){div.remove()}, 3000);" class="glass px-4 py-2 rounded-xl hover:bg-white/10 transition-all">
                        üîî Test Popup
                    </button>
                    <div class="flex items-center gap-2 glass px-4 py-2 rounded-xl">
                        <div class="w-2 h-2 bg-green-400 rounded-full pulse"></div>
                        <span class="text-sm font-medium">LIVE</span>
                    </div>
                    <div class="glass px-4 py-2 rounded-xl">
                        <span id="current-time" class="text-sm font-medium"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="glass rounded-2xl p-2 mb-6 flex gap-2 fade-in" style="animation-delay: 0.1s;">
            <button class="nav-btn active flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-blue-500/20 text-blue-400 border border-blue-500/30" onclick="showTab('overview')">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                Overview
            </button>

            <button class="nav-btn flex-1 px-6 py-3 rounded-xl font-medium transition-all text-gray-300 hover:bg-white/5" onclick="showTab('logs')">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Logs
            </button>
            <button class="nav-btn flex-1 px-6 py-3 rounded-xl font-medium transition-all text-gray-300 hover:bg-white/5" onclick="showTab('analytics')">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                Analytics
            </button>
            <button class="nav-btn flex-1 px-6 py-3 rounded-xl font-medium transition-all text-gray-300 hover:bg-white/5" onclick="showTab('reports')">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Reports
            </button>
            <button class="nav-btn flex-1 px-6 py-3 rounded-xl font-medium transition-all text-gray-300 hover:bg-white/5" onclick="showTab('attackmap')">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Attack Map
            </button>
        </nav>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                <div class="glass stat-card rounded-2xl p-6 border-l-4 border-red-500 fade-in cursor-pointer hover:scale-105" style="animation-delay: 0.2s;" onclick="showAlertDetails('CRITICAL')">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-gray-300 text-sm font-medium uppercase tracking-wide">Critical Alerts</h3>
                        <div class="w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        </div>
                    </div>
                    <div class="text-4xl font-bold text-white mb-1" id="critical-count">0</div>
                    <div class="text-xs text-gray-400">Click to view details</div>
                </div>
                <div class="glass stat-card rounded-2xl p-6 border-l-4 border-orange-500 fade-in cursor-pointer hover:scale-105" style="animation-delay: 0.3s;" onclick="showAlertDetails('HIGH')">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-gray-300 text-sm font-medium uppercase tracking-wide">High Priority</h3>
                        <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        </div>
                    </div>
                    <div class="text-4xl font-bold text-white mb-1" id="high-count">0</div>
                    <div class="text-xs text-gray-400">Click to view details</div>
                </div>
                <div class="glass stat-card rounded-2xl p-6 border-l-4 border-yellow-500 fade-in cursor-pointer hover:scale-105" style="animation-delay: 0.4s;" onclick="showIncidentDetails()">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-gray-300 text-sm font-medium uppercase tracking-wide">Active Incidents</h3>
                        <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                    </div>
                    <div class="text-4xl font-bold text-white mb-1" id="incident-count">0</div>
                    <div class="text-xs text-gray-400">Click to view details</div>
                </div>
                <div class="glass stat-card rounded-2xl p-6 border-l-4 border-blue-500 fade-in" style="animation-delay: 0.5s;">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-gray-300 text-sm font-medium uppercase tracking-wide">Total Logs</h3>
                        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        </div>
                    </div>
                    <div class="text-4xl font-bold text-white mb-1" id="log-count">0</div>
                    <div class="text-xs text-gray-400">Events processed</div>
                </div>
                <div class="glass stat-card rounded-2xl p-6 border-l-4 border-purple-500 fade-in" style="animation-delay: 0.6s;">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-gray-300 text-sm font-medium uppercase tracking-wide">Network Traffic</h3>
                        <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"/></svg>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-white mb-1" id="network-rate">0 KB/s</div>
                    <div class="text-xs text-gray-400" id="network-connections">0 connections</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 0.6s;">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-blue-500 to-purple-500 rounded-full"></div>
                        Alert Severity Distribution
                    </h3>
                    <div class="chart-container" style="position: relative;">
                        <canvas id="severityChart"></canvas>
                        <div id="severityTotal" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none;">
                            <div style="font-size: 36px; font-weight: bold; color: white;">0</div>
                            <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Total Alerts</div>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 0.7s;">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>
                        Alert Trend (Live)
                    </h3>
                    <div class="chart-container"><canvas id="trendChart"></canvas></div>
                </div>
                <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 0.8s;">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-emerald-500 rounded-full"></div>
                        üíª Live CPU Monitor
                        <div class="w-3 h-3 bg-green-400 rounded-full pulse ml-2"></div>
                    </h3>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-300 text-sm">CPU Usage</span>
                            <span class="text-2xl font-bold text-green-400" id="cpuPercent">0%</span>
                        </div>
                        <div class="w-full h-4 glass rounded-full overflow-hidden">
                            <div id="cpuBar" class="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">CPU Cores:</span>
                            <span class="text-white" id="cpuCores">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Frequency:</span>
                            <span class="text-white" id="cpuFreq">- MHz</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span class="text-green-400" id="cpuStatus">Normal</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Attackers Table -->
            <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 0.8s;">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <div class="w-1 h-6 bg-gradient-to-b from-red-500 to-orange-500 rounded-full"></div>
                    Top Threat Sources
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-white/10">
                                <th class="text-left text-gray-300 py-3 px-4 font-semibold text-sm">IP Address</th>
                                <th class="text-left text-gray-300 py-3 px-4 font-semibold text-sm">Alert Count</th>
                                <th class="text-left text-gray-300 py-3 px-4 font-semibold text-sm">Threat Level</th>
                            </tr>
                        </thead>
                        <tbody id="top-attackers-body" class="text-white"></tbody>
                    </table>
                </div>
            </div>

            <!-- Live Threat Intelligence Feed -->
            <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 0.9s;">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>
                        üåê Live Threat Intelligence Feed
                        <div class="w-3 h-3 bg-red-500 rounded-full pulse ml-2"></div>
                    </h3>
                    <div class="text-xs text-gray-400" id="threatFeedLastUpdate">Last updated: --</div>
                </div>
                <div id="threatFeedContainer" class="space-y-2 max-h-80 overflow-y-auto custom-scrollbar">
                    <div class="text-gray-400 text-center py-4">Loading threat intelligence...</div>
                </div>
            </div>

            <!-- AI Threat Prediction -->
            <div class="glass rounded-2xl p-6 fade-in" style="animation-delay: 1.0s;">
                <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                    <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>
                    ü§ñ AI Threat Prediction
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-300 text-sm">Threat Score</span>
                                <span class="text-2xl font-bold" id="threatScore" style="color: #10b981;">0</span>
                            </div>
                            <div class="w-full h-4 glass rounded-full overflow-hidden">
                                <div id="threatScoreBar" class="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 transition-all duration-1000" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="glass rounded-lg p-3">
                                <div class="text-xs text-gray-400 mb-1">Next Attack Prediction</div>
                                <div class="text-white font-medium" id="nextAttackTime">Calculating...</div>
                            </div>
                            <div class="glass rounded-lg p-3">
                                <div class="text-xs text-gray-400 mb-1">Most Likely Attack Type</div>
                                <div class="text-white font-medium" id="attackType">Analyzing...</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-300 mb-3">üß† AI Recommendations</div>
                        <div id="aiRecommendations" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content hidden">
            <div class="glass rounded-2xl p-6">
                <div class="flex gap-4 mb-6">
                    <button onclick="loadLogs()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-semibold shadow-lg">
                        üîÑ Refresh Logs
                    </button>
                    <button onclick="fetch('/api/clear-logs', {method:'POST'}).then(r=>r.json()).then(d=>{alert('‚úÖ ' + d.message); window.lastLogCheck=0; window.lastAlertCheck=0; loadLogs();})" class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl font-semibold shadow-lg">
                        üóëÔ∏è Clear Logs
                    </button>
                    <input type="text" id="log-search" placeholder="üîç Search logs..." onkeyup="searchLogs()" class="flex-1 px-4 py-3 rounded-xl text-white placeholder-gray-400 focus:outline-none font-medium">
                </div>
                <div id="logs-container" class="space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content hidden">
            <!-- Analytics Header with Controls -->
            <div class="glass rounded-2xl p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                        </div>
                        Security Analytics Dashboard
                    </h2>
                    <div class="flex gap-3">
                        <select id="timeRange" class="glass px-4 py-2 rounded-xl text-white focus:outline-none" onchange="updateAnalytics()">
                            <option value="7d">Last 7 Days</option>
                            <option value="24h">Last 24 Hours</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                        <button onclick="loadAnalyticsCharts()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-xl font-semibold shadow-lg transition-all">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="glass rounded-xl p-4 border-l-4 border-red-500">
                        <div class="text-red-400 text-sm font-medium">Avg Response Time</div>
                        <div class="text-2xl font-bold text-white" id="avgResponseTime">2.3m</div>
                    </div>
                    <div class="glass rounded-xl p-4 border-l-4 border-green-500">
                        <div class="text-green-400 text-sm font-medium">Detection Rate</div>
                        <div class="text-2xl font-bold text-white" id="detectionRate">94.7%</div>
                    </div>
                    <div class="glass rounded-xl p-4 border-l-4 border-yellow-500">
                        <div class="text-yellow-400 text-sm font-medium">False Positives</div>
                        <div class="text-2xl font-bold text-white" id="falsePositives">3.2%</div>
                    </div>
                    <div class="glass rounded-xl p-4 border-l-4 border-blue-500">
                        <div class="text-blue-400 text-sm font-medium">MTTR</div>
                        <div class="text-2xl font-bold text-white" id="mttr">18m</div>
                    </div>
                </div>
            </div>

            <!-- Main Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-emerald-500 rounded-full"></div>
                        Alert Volume Trends
                    </h3>
                    <div class="chart-container"><canvas id="alertTrendChart"></canvas></div>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-cyan-500 to-blue-500 rounded-full"></div>
                        Detection Methods
                    </h3>
                    <div class="chart-container"><canvas id="detectionChart"></canvas></div>
                </div>
            </div>

            <!-- Threat Intelligence & Risk Assessment -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-red-500 to-pink-500 rounded-full"></div>
                        üéØ Threat Actor Attribution
                    </h3>
                    <div class="space-y-3" id="threatActorList">
                        <div class="glass rounded-lg p-3 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-red-500/20 rounded-lg flex items-center justify-center">
                                    <span class="text-red-400 text-sm font-bold">APT</span>
                                </div>
                                <div>
                                    <div class="text-white font-medium">APT29 (Cozy Bear)</div>
                                    <div class="text-gray-400 text-xs">Russia-linked group</div>
                                </div>
                            </div>
                            <div class="text-red-400 font-bold">High</div>
                        </div>
                        <div class="glass rounded-lg p-3 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                    <span class="text-orange-400 text-sm font-bold">RAN</span>
                                </div>
                                <div>
                                    <div class="text-white font-medium">Conti Ransomware</div>
                                    <div class="text-gray-400 text-xs">Financial motivation</div>
                                </div>
                            </div>
                            <div class="text-orange-400 font-bold">Medium</div>
                        </div>
                        <div class="glass rounded-lg p-3 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                    <span class="text-yellow-400 text-sm font-bold">BOT</span>
                                </div>
                                <div>
                                    <div class="text-white font-medium">Emotet Botnet</div>
                                    <div class="text-gray-400 text-xs">Malware distribution</div>
                                </div>
                            </div>
                            <div class="text-yellow-400 font-bold">Low</div>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-blue-500 rounded-full"></div>
                        üõ°Ô∏è Security Posture Score
                    </h3>
                    <div class="text-center mb-6">
                        <div class="text-6xl font-bold text-green-400 mb-2" id="securityScore">87</div>
                        <div class="text-gray-300">Overall Security Rating</div>
                        <div class="w-full h-4 glass rounded-full mt-4 overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-green-400 to-blue-500 transition-all duration-1000" style="width: 87%"></div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Detection Coverage</span>
                            <span class="text-green-400 font-bold">94%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Response Readiness</span>
                            <span class="text-yellow-400 font-bold">78%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Threat Intelligence</span>
                            <span class="text-blue-400 font-bold">91%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Analytics Feed -->
            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>
                    üìä Real-time Analytics Feed
                    <div class="w-3 h-3 bg-green-400 rounded-full pulse ml-2"></div>
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="analyticsMetrics">
                    <div class="glass rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-400" id="eventsPerSecond">12.3</div>
                        <div class="text-xs text-gray-400">Events/sec</div>
                    </div>
                    <div class="glass rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="blockedThreats">1,247</div>
                        <div class="text-xs text-gray-400">Blocked Today</div>
                    </div>
                    <div class="glass rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="activeRules">89</div>
                        <div class="text-xs text-gray-400">Active Rules</div>
                    </div>
                    <div class="glass rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-purple-400" id="correlationRate">96.2%</div>
                        <div class="text-xs text-gray-400">Correlation Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Executive Summary</h3>
                            <p class="text-sm text-gray-400">High-level security overview</p>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm mb-4">Comprehensive report with key metrics, trends, and recommendations for leadership.</p>
                    <button onclick="generateExecutiveReport()" class="w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-semibold shadow-lg transition-all">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        Generate Report
                    </button>
                </div>

                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Compliance Report</h3>
                            <p class="text-sm text-gray-400">Regulatory compliance status</p>
                        </div>
                    </div>
                    <div class="mb-4">
                        <select id="complianceFramework" class="w-full px-4 py-2 glass rounded-xl text-white focus:outline-none">
                            <option value="ISO27001">ISO 27001</option>
                            <option value="NIST">NIST CSF</option>
                            <option value="PCI-DSS">PCI-DSS</option>
                            <option value="GDPR">GDPR</option>
                        </select>
                    </div>
                    <button onclick="generateComplianceReport()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-xl font-semibold shadow-lg transition-all">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        Generate Report
                    </button>
                </div>
            </div>

            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-emerald-500 rounded-full"></div>
                    Recent Reports
                </h3>
                <div id="recentReports" class="space-y-3">
                    <div class="text-gray-400 text-sm text-center py-8">No reports generated yet. Click above to generate your first report.</div>
                </div>
            </div>
        </div>

        <!-- Attack Map Tab -->
        <div id="attackmap" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-white">Live Attacks</h3>
                        <div class="w-3 h-3 bg-red-500 rounded-full pulse"></div>
                    </div>
                    <div class="text-5xl font-bold text-red-400 mb-2" id="liveAttackCount">0</div>
                    <div class="text-sm text-gray-400">Active threats detected</div>
                </div>
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-white">Blocked IPs</h3>
                        <div class="w-3 h-3 bg-green-500 rounded-full pulse"></div>
                    </div>
                    <div class="text-5xl font-bold text-green-400 mb-2" id="blockedCount">0</div>
                    <div class="text-sm text-gray-400">Threats neutralized</div>
                </div>
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-white">Countries</h3>
                        <div class="w-3 h-3 bg-blue-500 rounded-full pulse"></div>
                    </div>
                    <div class="text-5xl font-bold text-blue-400 mb-2" id="countryCount">0</div>
                    <div class="text-sm text-gray-400">Attack sources</div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <div class="w-1 h-6 bg-gradient-to-b from-red-500 to-orange-500 rounded-full"></div>
                        Global Attack Map
                    </h3>
                    <button onclick="toggleDemoMode()" id="demoBtn" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-semibold shadow-lg transition-all">
                        üéÆ Start Demo Mode
                    </button>
                </div>
                <div id="attackMapContainer" style="height: 500px; position: relative; background: rgba(0,0,0,0.3); border-radius: 16px; overflow: hidden;">
                    <canvas id="attackMapCanvas" style="width: 100%; height: 100%;"></canvas>
                </div>
            </div>

            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <div class="w-1 h-6 bg-gradient-to-b from-yellow-500 to-red-500 rounded-full"></div>
                    Top Attack Sources
                </h3>
                <div id="attackSourcesList" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- Notification Container - FIXED POSITION -->
    <div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 99999; max-width: 350px;"></div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/reports.js') }}"></script>
    <script>
        console.log('Dashboard inline script loaded');
        

        

        
        function showLivePopup(title, message, severity) {
            console.log('Showing popup:', title, message, severity);
            const container = document.getElementById('notification-container');
            if (!container) {
                console.error('Notification container not found!');
                return;
            }
            
            const colors = {
                CRITICAL: { bg: 'rgba(239, 68, 68, 0.2)', border: '#ef4444', icon: 'text-red-400' },
                HIGH: { bg: 'rgba(249, 115, 22, 0.2)', border: '#f97316', icon: 'text-orange-400' },
                MEDIUM: { bg: 'rgba(234, 179, 8, 0.2)', border: '#eab308', icon: 'text-yellow-400' },
                LOW: { bg: 'rgba(59, 130, 246, 0.2)', border: '#3b82f6', icon: 'text-blue-400' },
                INFO: { bg: 'rgba(107, 114, 128, 0.2)', border: '#6b7280', icon: 'text-gray-400' }
            };
            
            const color = colors[severity] || colors.INFO;
            
            const notification = document.createElement('div');
            notification.className = 'notification-popup';
            notification.style.cssText = `
                background: linear-gradient(135deg, ${color.bg}, rgba(0,0,0,0.1));
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-left: 4px solid ${color.border};
                padding: 16px;
                border-radius: 12px;
                margin-bottom: 8px;
                animation: slideInRight 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                max-width: 350px;
                position: relative;
                z-index: 1000;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items-start; gap: 12px;">
                    <div style="flex-shrink: 0; margin-top: 2px;">
                        <svg class="w-5 h-5 ${color.icon}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 700; font-size: 14px; color: white; margin-bottom: 4px; line-height: 1.3;">${title}</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 6px; line-height: 1.4;">${message}</div>
                        <div style="color: rgba(255,255,255,0.5); font-size: 10px;">${new Date().toLocaleTimeString()}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none; border: none; color: rgba(255,255,255,0.6); 
                        cursor: pointer; font-size: 18px; line-height: 1; padding: 0;
                        width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
                        transition: color 0.2s;
                    " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255,255,255,0.6)'">&times;</button>
                </div>
            `;
            
            container.appendChild(notification);
            console.log('Popup added to container');
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        // Show alert details popup
        function showAlertDetails(severity) {
            fetch('/api/alerts')
                .then(r => r.json())
                .then(alerts => {
                    var filteredAlerts = alerts.filter(a => a.severity === severity);
                    var popup = document.createElement('div');
                    popup.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:white;padding:30px;border-radius:15px;z-index:99999;max-width:600px;max-height:80vh;overflow-y:auto;border:2px solid ' + (severity === 'CRITICAL' ? '#ef4444' : '#f97316') + ';';
                    
                    var content = '<h2 style="margin-bottom:20px;color:' + (severity === 'CRITICAL' ? '#ef4444' : '#f97316') + ';">üö® ' + severity + ' ALERTS (' + filteredAlerts.length + ')</h2>';
                    
                    if (filteredAlerts.length === 0) {
                        content += '<p>No ' + severity.toLowerCase() + ' alerts found.</p>';
                    } else {
                        filteredAlerts.forEach(function(alert) {
                            content += '<div style="background:rgba(255,255,255,0.1);padding:15px;margin:10px 0;border-radius:8px;border-left:4px solid ' + (severity === 'CRITICAL' ? '#ef4444' : '#f97316') + ';">';
                            content += '<div style="font-weight:bold;margin-bottom:8px;">' + (alert.title || 'Security Alert') + '</div>';
                            content += '<div style="font-size:13px;opacity:0.8;margin-bottom:5px;">Source: ' + (alert.source_ip || 'Unknown') + '</div>';
                            content += '<div style="font-size:13px;opacity:0.8;margin-bottom:5px;">MITRE: ' + (alert.mitre_attack || 'N/A') + '</div>';
                            content += '<div style="font-size:12px;opacity:0.6;">' + new Date(alert.timestamp).toLocaleString() + '</div>';
                            content += '</div>';
                        });
                    }
                    
                    content += '<button onclick="this.parentElement.remove()" style="position:absolute;top:10px;right:15px;background:none;border:none;color:white;font-size:20px;cursor:pointer;">√ó</button>';
                    popup.innerHTML = content;
                    document.body.appendChild(popup);
                })
                .catch(e => alert('Error loading alerts: ' + e));
        }
        
        // Show incident details popup
        function showIncidentDetails() {
            fetch('/api/incidents')
                .then(r => r.json())
                .then(incidents => {
                    var activeIncidents = incidents.filter(i => i.status === 'INVESTIGATING');
                    var popup = document.createElement('div');
                    popup.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:white;padding:30px;border-radius:15px;z-index:99999;max-width:600px;max-height:80vh;overflow-y:auto;border:2px solid #eab308;';
                    
                    var content = '<h2 style="margin-bottom:20px;color:#eab308;">‚ö†Ô∏è ACTIVE INCIDENTS (' + activeIncidents.length + ')</h2>';
                    
                    if (activeIncidents.length === 0) {
                        content += '<p>No active incidents found.</p>';
                    } else {
                        activeIncidents.forEach(function(incident) {
                            content += '<div style="background:rgba(255,255,255,0.1);padding:15px;margin:10px 0;border-radius:8px;border-left:4px solid #eab308;">';
                            content += '<div style="font-weight:bold;margin-bottom:8px;">' + (incident.title || 'Security Incident') + '</div>';
                            content += '<div style="font-size:13px;opacity:0.8;margin-bottom:5px;">ID: ' + incident.incident_id + '</div>';
                            content += '<div style="font-size:13px;opacity:0.8;margin-bottom:5px;">Severity: ' + incident.severity + '</div>';
                            content += '<div style="font-size:13px;opacity:0.8;margin-bottom:5px;">Status: ' + incident.status + '</div>';
                            content += '<div style="font-size:12px;opacity:0.6;">' + new Date(incident.created_at).toLocaleString() + '</div>';
                            content += '</div>';
                        });
                    }
                    
                    content += '<button onclick="this.parentElement.remove()" style="position:absolute;top:10px;right:15px;background:none;border:none;color:white;font-size:20px;cursor:pointer;">√ó</button>';
                    popup.innerHTML = content;
                    document.body.appendChild(popup);
                })
                .catch(e => alert('Error loading incidents: ' + e));
        }
        
        // SIMPLE POPUP FUNCTION - NO BULLSHIT
        function showPopup(message) {
            var popup = document.createElement('div');
            popup.innerHTML = message;
            popup.style.cssText = 'position:fixed;top:20px;right:20px;background:#ef4444;color:white;padding:15px;border-radius:8px;z-index:99999;box-shadow:0 4px 20px rgba(0,0,0,0.5);';
            document.body.appendChild(popup);
            setTimeout(function() { popup.remove(); }, 3000);
        }
        
        // Dark Mode Toggle Function
        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('darkModeIcon');
            const text = document.getElementById('darkModeText');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                // Switch to light mode
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
                text.textContent = 'Light';
                localStorage.setItem('theme', 'light');
            } else {
                // Switch to dark mode
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
                text.textContent = 'Dark';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme on page load
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                const icon = document.getElementById('darkModeIcon');
                const text = document.getElementById('darkModeText');
                if (icon && text) {
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
                    text.textContent = 'Light';
                }
            }
        }
        
        // Network Traffic Monitor Function
        async function updateNetworkTraffic() {
            try {
                const response = await fetch('/api/network/traffic');
                const data = await response.json();
                
                const rateEl = document.getElementById('network-rate');
                const connectionsEl = document.getElementById('network-connections');
                
                if (rateEl && data.bytes_recv_rate !== undefined) {
                    const totalRate = (data.bytes_sent_rate + data.bytes_recv_rate) / 1024; // Convert to KB/s
                    rateEl.textContent = totalRate.toFixed(1) + ' KB/s';
                }
                
                if (connectionsEl && data.active_connections !== undefined) {
                    connectionsEl.textContent = data.active_connections + ' connections';
                }
                
            } catch (error) {
                console.error('Network traffic error:', error);
                const rateEl = document.getElementById('network-rate');
                if (rateEl) {
                    rateEl.textContent = 'Error';
                }
            }
        }
        
        // Threat Intelligence Feed Function
        async function updateThreatFeed() {
            try {
                const response = await fetch('/api/threat-feed/live');
                const data = await response.json();
                
                const container = document.getElementById('threatFeedContainer');
                const lastUpdateEl = document.getElementById('threatFeedLastUpdate');
                
                if (container && data.feed_items) {
                    container.innerHTML = '';
                    
                    data.feed_items.forEach(item => {
                        const feedItem = document.createElement('div');
                        feedItem.className = 'glass rounded-lg p-3 hover:bg-white/10 transition-all border-l-4';
                        
                        // Color based on severity
                        const severityColors = {
                            'CRITICAL': 'border-red-500',
                            'HIGH': 'border-orange-500',
                            'MEDIUM': 'border-yellow-500'
                        };
                        feedItem.className += ' ' + (severityColors[item.severity] || 'border-gray-500');
                        
                        const threatIcons = {
                            'Malware': 'ü¶†',
                            'Phishing': 'üé£',
                            'Botnet': 'ü§ñ',
                            'APT': 'üï∑Ô∏è',
                            'Ransomware': 'üîí',
                            'DDoS': 'üåä'
                        };
                        
                        feedItem.innerHTML = `
                            <div class="flex items-start justify-between">
                                <div class="flex items-start gap-3 flex-1">
                                    <div class="text-lg">${threatIcons[item.threat_type] || '‚ö†Ô∏è'}</div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-white font-medium text-sm">${item.threat_type}</span>
                                            <span class="badge badge-${item.severity.toLowerCase()} text-xs">${item.severity}</span>
                                        </div>
                                        <div class="text-gray-300 text-xs mb-1">${item.description}</div>
                                        <div class="flex items-center gap-3 text-xs text-gray-400">
                                            <span>üåç ${item.country}</span>
                                            <span>üìç ${item.source_ip}</span>
                                            <span>üéØ ${item.confidence}% confidence</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500">
                                    ${new Date(item.timestamp).toLocaleTimeString()}
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(feedItem);
                    });
                }
                
                if (lastUpdateEl) {
                    lastUpdateEl.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                }
                
            } catch (error) {
                console.error('Threat feed error:', error);
                const container = document.getElementById('threatFeedContainer');
                if (container) {
                    container.innerHTML = '<div class="text-red-400 text-center py-4">Error loading threat feed</div>';
                }
            }
        }
        
        // CPU Monitor Function
        async function updateCPUMonitor() {
            try {
                const response = await fetch('/api/system/cpu');
                const data = await response.json();
                
                const cpuPercent = Math.round(data.cpu_percent);
                const cpuPercentEl = document.getElementById('cpuPercent');
                const cpuBarEl = document.getElementById('cpuBar');
                const cpuCoresEl = document.getElementById('cpuCores');
                const cpuFreqEl = document.getElementById('cpuFreq');
                const cpuStatusEl = document.getElementById('cpuStatus');
                
                if (cpuPercentEl && cpuBarEl) {
                    cpuPercentEl.textContent = cpuPercent + '%';
                    cpuBarEl.style.width = cpuPercent + '%';
                    
                    // Color based on usage
                    if (cpuPercent < 50) {
                        cpuPercentEl.style.color = '#10b981';
                        cpuStatusEl.textContent = 'Normal';
                        cpuStatusEl.style.color = '#10b981';
                    } else if (cpuPercent < 80) {
                        cpuPercentEl.style.color = '#eab308';
                        cpuStatusEl.textContent = 'Moderate';
                        cpuStatusEl.style.color = '#eab308';
                    } else {
                        cpuPercentEl.style.color = '#ef4444';
                        cpuStatusEl.textContent = 'High';
                        cpuStatusEl.style.color = '#ef4444';
                    }
                }
                
                if (cpuCoresEl) {
                    cpuCoresEl.textContent = data.cpu_count || '-';
                }
                
                if (cpuFreqEl && data.cpu_freq) {
                    cpuFreqEl.textContent = Math.round(data.cpu_freq.current) + ' MHz';
                }
                
            } catch (error) {
                console.error('CPU monitor error:', error);
                const cpuPercentEl = document.getElementById('cpuPercent');
                if (cpuPercentEl) {
                    cpuPercentEl.textContent = 'Error';
                    cpuPercentEl.style.color = '#ef4444';
                }
            }
        }
        
        // MONITOR FOR NEW LOGS AND ALERTS - FAST AND LIVE
        setInterval(function() {
            // Update CPU monitor
            updateCPUMonitor();
            
            // Update network traffic
            updateNetworkTraffic();
            
            // Update threat intelligence feed
            updateThreatFeed();
            
            // Update stats on overview tab
            fetch('/api/stats')
                .then(r => r.json())
                .then(stats => {
                    document.getElementById('critical-count').textContent = stats.severity_distribution.CRITICAL;
                    document.getElementById('high-count').textContent = stats.severity_distribution.HIGH;
                    document.getElementById('incident-count').textContent = stats.active_incidents;
                    document.getElementById('log-count').textContent = stats.total_logs;
                    loadCharts(stats);
                })
                .catch(e => console.log('Stats update failed:', e));
            
            // Check for new alerts
            fetch('/api/alerts')
                .then(r => r.json())
                .then(alerts => {
                    if (!window.lastAlertCheck) window.lastAlertCheck = 0;
                    if (alerts.length > window.lastAlertCheck) {
                        var newAlerts = alerts.slice(window.lastAlertCheck);
                        newAlerts.forEach(function(alert) {
                            showPopup('üö® ALERT: ' + (alert.title || 'Security Alert') + ' from ' + (alert.source_ip || 'Unknown'));
                        });
                        window.lastAlertCheck = alerts.length;
                    }
                })
                .catch(e => console.log('Alert check failed:', e));
            
            // Check for new logs
            fetch('/api/logs?limit=100')
                .then(r => r.json())
                .then(logs => {
                    if (!window.lastLogCheck) window.lastLogCheck = 0;
                    if (logs.length > window.lastLogCheck) {
                        var newLogs = logs.slice(window.lastLogCheck);
                        newLogs.forEach(function(log) {
                            showPopup('üìã LOG: ' + (log.event_type || 'Event') + ' from ' + (log.source_ip || 'Unknown') + ' [' + (log.severity || 'INFO') + ']');
                        });
                        window.lastLogCheck = logs.length;
                        
                        // Auto-refresh logs tab if visible
                        if (!document.getElementById('logs').classList.contains('hidden')) {
                            loadLogs();
                        }
                    }
                })
                .catch(e => console.log('Log check failed:', e));
        }, 1000);
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('active', 'bg-blue-500/20', 'text-blue-400', 'border', 'border-blue-500/30');
                el.classList.add('text-gray-300');
            });
            document.getElementById(tabName).classList.remove('hidden');
            event.target.classList.add('active', 'bg-blue-500/20', 'text-blue-400', 'border', 'border-blue-500/30');
            event.target.classList.remove('text-gray-300');
            
            if (tabName === 'logs') loadLogs();
            if (tabName === 'analytics') loadAnalyticsCharts();
            if (tabName === 'attackmap') initAttackMap();
        }
        
        async function loadLogs() {
            console.log('Loading logs...');
            try {
                const response = await fetch('/api/logs?limit=50');
                const logs = await response.json();
                console.log('Logs received:', logs.length);
                
                const container = document.getElementById('logs-container');
                container.innerHTML = '';
                
                if (!logs || logs.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center py-8">No logs available. Run: python quick_test.py</div>';
                    return;
                }
                
                logs.reverse().forEach((log, index) => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'glass rounded-xl p-4 mb-2';
                    logEntry.style.animation = 'fadeIn 0.3s ease-out forwards';
                    logEntry.style.animationDelay = `${index * 0.02}s`;
                    
                    const severityColors = {
                        CRITICAL: 'border-l-4 border-red-500',
                        HIGH: 'border-l-4 border-orange-500',
                        MEDIUM: 'border-l-4 border-yellow-500',
                        LOW: 'border-l-4 border-blue-500',
                        INFO: 'border-l-4 border-gray-500'
                    };
                    
                    const severity = log.severity || 'INFO';
                    logEntry.className += ' ' + (severityColors[severity] || severityColors.INFO);
                    
                    logEntry.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 16px; color: white;">
                            <div style="flex-shrink: 0; width: 140px; color: rgba(255,255,255,0.5); font-size: 12px; font-family: monospace;">
                                ${log.timestamp || new Date().toISOString()}
                            </div>
                            <div style="flex-shrink: 0; width: 120px; color: #60a5fa; font-size: 13px; font-family: monospace; font-weight: 500;">
                                ${log.source_ip || 'N/A'}
                            </div>
                            <div style="flex-shrink: 0; width: 80px;">
                                <span style="padding: 4px 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 10px; font-weight: 600;">${severity}</span>
                            </div>
                            <div style="flex: 1; color: rgba(255,255,255,0.8); font-size: 13px;">
                                ${log.message || log.event_type || 'No message'}
                            </div>
                        </div>
                    `;
                    container.appendChild(logEntry);
                });
                
                console.log('Logs displayed successfully');
            } catch (error) {
                console.error('Error loading logs:', error);
                document.getElementById('logs-container').innerHTML = '<div class="text-red-400 text-center py-8">Error: ' + error.message + '</div>';
            }
        }
        
        // Chart variables
        let severityChart, trendChart, alertTrendChart, detectionChart;
        
        // Load charts with real data
        function loadCharts(stats) {
            // Severity Chart - Clean & Modern
            const ctx1 = document.getElementById('severityChart');
            if (ctx1) {
                if (severityChart) severityChart.destroy();
                
                const severityData = [
                    stats.severity_distribution.CRITICAL,
                    stats.severity_distribution.HIGH,
                    stats.severity_distribution.MEDIUM,
                    stats.severity_distribution.LOW,
                    stats.severity_distribution.INFO
                ];
                const total = severityData.reduce((a, b) => a + b, 0);
                document.getElementById('severityTotal').querySelector('div').textContent = total;
                
                severityChart = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
                        datasets: [{
                            data: severityData,
                            backgroundColor: [
                                '#dc2626', // Critical - Bright Red
                                '#ea580c', // High - Orange
                                '#ca8a04', // Medium - Gold
                                '#2563eb', // Low - Blue
                                '#64748b'  // Info - Slate
                            ],
                            borderWidth: 0,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true,
                                    font: { size: 12, weight: '500' },
                                    color: '#e5e7eb'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#f9fafb',
                                bodyColor: '#f9fafb',
                                borderColor: 'rgba(75, 85, 99, 0.5)',
                                borderWidth: 1,
                                cornerRadius: 6,
                                padding: 10,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.parsed;
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0';
                                        return `${context.label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
            
            // Live Trend Chart - Real-time activity monitoring
            const ctx2 = document.getElementById('trendChart');
            if (ctx2) {
                // Initialize trend tracking
                if (!window.trendState) {
                    window.trendState = {
                        data: [],
                        labels: [],
                        lastLogCount: 0,
                        lastAlertCount: 0
                    };
                }
                
                const now = new Date();
                const timeLabel = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                // Get current counts
                const currentLogs = stats.total_logs || 0;
                const currentAlerts = stats.total_alerts || 0;
                
                // Calculate activity (new logs + new alerts)
                const newLogs = Math.max(0, currentLogs - window.trendState.lastLogCount);
                const newAlerts = Math.max(0, currentAlerts - window.trendState.lastAlertCount);
                const activity = newLogs + (newAlerts * 2); // Weight alerts more
                
                // Update tracking
                window.trendState.lastLogCount = currentLogs;
                window.trendState.lastAlertCount = currentAlerts;
                
                // Add data point
                window.trendState.labels.push(timeLabel);
                window.trendState.data.push(activity);
                
                // Keep last 15 points
                if (window.trendState.labels.length > 15) {
                    window.trendState.labels.shift();
                    window.trendState.data.shift();
                }
                
                if (trendChart) trendChart.destroy();
                
                trendChart = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: window.trendState.labels,
                        datasets: [{
                            label: 'Activity Level',
                            data: window.trendState.data,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 500 },
                        plugins: { 
                            legend: { labels: { color: '#fff' } },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Activity: ${context.parsed.y} events`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                ticks: { color: '#fff', stepSize: 1 },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: { 
                                ticks: { color: '#fff', maxTicksLimit: 8 },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
        }
        
        function loadAnalyticsCharts() {
            console.log('Loading analytics charts...');
            const timeRange = document.getElementById('timeRange')?.value || '7d';
            
            // Alert Volume Trend Chart
            const ctx1 = document.getElementById('alertTrendChart');
            if (ctx1) {
                if (alertTrendChart) alertTrendChart.destroy();
                
                fetch('/api/alerts')
                    .then(res => res.json())
                    .then(alerts => {
                        let days, dateFormat;
                        const timeData = {};
                        const today = new Date();
                        
                        // Configure time range
                        if (timeRange === '24h') {
                            days = 24;
                            dateFormat = (date) => date.getHours().toString().padStart(2, '0') + ':00';
                            for (let i = 23; i >= 0; i--) {
                                const date = new Date(today);
                                date.setHours(date.getHours() - i);
                                const key = dateFormat(date);
                                timeData[key] = { critical: 0, high: 0, medium: 0 };
                            }
                        } else if (timeRange === '30d') {
                            days = 30;
                            dateFormat = (date) => (date.getMonth() + 1) + '/' + date.getDate();
                            for (let i = 29; i >= 0; i--) {
                                const date = new Date(today);
                                date.setDate(date.getDate() - i);
                                const key = dateFormat(date);
                                timeData[key] = { critical: 0, high: 0, medium: 0 };
                            }
                        } else { // 7d default
                            days = 7;
                            dateFormat = (date) => date.toLocaleDateString('en-US', { weekday: 'short' });
                            for (let i = 6; i >= 0; i--) {
                                const date = new Date(today);
                                date.setDate(date.getDate() - i);
                                const key = dateFormat(date);
                                timeData[key] = { critical: 0, high: 0, medium: 0 };
                            }
                        }
                        
                        // Filter and count alerts by time range
                        const cutoffTime = new Date();
                        if (timeRange === '24h') cutoffTime.setHours(cutoffTime.getHours() - 24);
                        else if (timeRange === '30d') cutoffTime.setDate(cutoffTime.getDate() - 30);
                        else cutoffTime.setDate(cutoffTime.getDate() - 7);
                        
                        alerts.forEach(alert => {
                            const alertDate = new Date(alert.timestamp);
                            if (alertDate >= cutoffTime) {
                                const key = dateFormat(alertDate);
                                if (timeData[key]) {
                                    if (alert.severity === 'CRITICAL') timeData[key].critical++;
                                    else if (alert.severity === 'HIGH') timeData[key].high++;
                                    else if (alert.severity === 'MEDIUM') timeData[key].medium++;
                                }
                            }
                        });
                        
                        const labels = Object.keys(timeData);
                        const criticalData = Object.values(timeData).map(d => d.critical);
                        const highData = Object.values(timeData).map(d => d.high);
                        const mediumData = Object.values(timeData).map(d => d.medium);
                        
                        alertTrendChart = new Chart(ctx1, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Critical',
                                        data: criticalData,
                                        borderColor: '#dc2626',
                                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                        borderWidth: 3,
                                        fill: false,
                                        tension: 0.4,
                                        pointRadius: 5,
                                        pointHoverRadius: 8
                                    },
                                    {
                                        label: 'High',
                                        data: highData,
                                        borderColor: '#ea580c',
                                        backgroundColor: 'rgba(234, 88, 12, 0.1)',
                                        borderWidth: 3,
                                        fill: false,
                                        tension: 0.4,
                                        pointRadius: 5,
                                        pointHoverRadius: 8
                                    },
                                    {
                                        label: 'Medium',
                                        data: mediumData,
                                        borderColor: '#ca8a04',
                                        backgroundColor: 'rgba(202, 138, 4, 0.1)',
                                        borderWidth: 3,
                                        fill: false,
                                        tension: 0.4,
                                        pointRadius: 5,
                                        pointHoverRadius: 8
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            color: '#e5e7eb',
                                            font: { size: 12, weight: '500' },
                                            padding: 20
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                        titleColor: '#f9fafb',
                                        bodyColor: '#f9fafb',
                                        borderColor: 'rgba(75, 85, 99, 0.5)',
                                        borderWidth: 1,
                                        cornerRadius: 6
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: { color: 'rgba(255,255,255,0.1)' },
                                        ticks: { color: '#e5e7eb', font: { size: 11 } }
                                    },
                                    x: {
                                        grid: { display: false },
                                        ticks: { color: '#e5e7eb', font: { size: 11 }, maxRotation: 45 }
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Error loading alert trend:', error);
                        // Generate different fallback data based on time range
                        let labels, sampleData;
                        if (timeRange === '24h') {
                            labels = Array.from({length: 24}, (_, i) => `${i}:00`);
                            sampleData = Array.from({length: 24}, () => Math.floor(Math.random() * 5));
                        } else if (timeRange === '30d') {
                            labels = Array.from({length: 30}, (_, i) => `${i+1}/1`);
                            sampleData = Array.from({length: 30}, () => Math.floor(Math.random() * 15));
                        } else {
                            labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                            sampleData = [5, 8, 12, 7, 15, 9, 6];
                        }
                        
                        alertTrendChart = new Chart(ctx1, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Sample Data',
                                    data: sampleData,
                                    borderColor: '#6366f1',
                                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                    borderWidth: 3,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { labels: { color: '#e5e7eb' } } },
                                scales: {
                                    y: { beginAtZero: true, ticks: { color: '#e5e7eb' } },
                                    x: { ticks: { color: '#e5e7eb' } }
                                }
                            }
                        });
                    });
            }
            
            // Detection Methods Radar Chart
            const ctx2 = document.getElementById('detectionChart');
            if (ctx2) {
                if (detectionChart) detectionChart.destroy();
                
                fetch('/api/alerts')
                    .then(res => res.json())
                    .then(alerts => {
                        const methods = {
                            'Signature': 0,
                            'Anomaly': 0,
                            'Behavioral': 0,
                            'ML Detection': 0,
                            'Rule-based': 0
                        };
                        
                        // Categorize alerts by detection method
                        alerts.forEach(alert => {
                            const rule = (alert.rule_name || '').toLowerCase();
                            if (rule.includes('ml') || rule.includes('machine')) methods['ML Detection']++;
                            else if (rule.includes('anomaly')) methods['Anomaly']++;
                            else if (rule.includes('behavior')) methods['Behavioral']++;
                            else if (rule.includes('signature')) methods['Signature']++;
                            else methods['Rule-based']++;
                        });
                        
                        const maxValue = Math.max(...Object.values(methods), 10);
                        
                        detectionChart = new Chart(ctx2, {
                            type: 'radar',
                            data: {
                                labels: Object.keys(methods),
                                datasets: [{
                                    label: 'Detection Count',
                                    data: Object.values(methods),
                                    borderColor: '#6366f1',
                                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                                    borderWidth: 3,
                                    pointBackgroundColor: '#6366f1',
                                    pointBorderColor: '#ffffff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6,
                                    pointHoverRadius: 8
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                        titleColor: '#f9fafb',
                                        bodyColor: '#f9fafb',
                                        borderColor: 'rgba(75, 85, 99, 0.5)',
                                        borderWidth: 1,
                                        cornerRadius: 6
                                    }
                                },
                                scales: {
                                    r: {
                                        beginAtZero: true,
                                        max: maxValue,
                                        ticks: {
                                            display: true,
                                            color: 'rgba(229, 231, 235, 0.6)',
                                            font: { size: 10 },
                                            stepSize: Math.ceil(maxValue / 5)
                                        },
                                        pointLabels: {
                                            color: '#e5e7eb',
                                            font: { size: 12, weight: '500' }
                                        },
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        },
                                        angleLines: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        }
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Error loading detection data:', error);
                        // Fallback radar chart
                        detectionChart = new Chart(ctx2, {
                            type: 'radar',
                            data: {
                                labels: ['Signature', 'Anomaly', 'Behavioral', 'ML Detection', 'Rule-based'],
                                datasets: [{
                                    label: 'Sample Data',
                                    data: [8, 6, 9, 7, 12],
                                    borderColor: '#6366f1',
                                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                                    borderWidth: 3
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    r: {
                                        beginAtZero: true,
                                        ticks: { color: '#e5e7eb' },
                                        pointLabels: { color: '#e5e7eb' },
                                        grid: { color: 'rgba(255,255,255,0.1)' }
                                    }
                                }
                            }
                        });
                    });
            }
        }
        
        function getCountryFromIP(ip) {
            const ipRanges = {
                'Russia': ['185.', '91.', '95.'],
                'China': ['114.', '123.', '202.'],
                'USA': ['192.', '198.', '204.'],
                'Iran': ['5.', '31.', '37.'],
                'Unknown': ['10.', '172.', '127.']
            };
            
            for (const [country, ranges] of Object.entries(ipRanges)) {
                if (ranges.some(range => ip.startsWith(range))) return country;
            }
            return 'Other';
        }
        
        function updateAnalytics() {
            const timeRange = document.getElementById('timeRange')?.value || '7d';
            loadAnalyticsCharts();
            
            // Update metrics based on time range
            const multiplier = timeRange === '24h' ? 0.3 : timeRange === '30d' ? 2.5 : 1;
            
            document.getElementById('eventsPerSecond').textContent = (Math.random() * 20 + 5).toFixed(1);
            document.getElementById('blockedThreats').textContent = Math.floor((Math.random() * 500 + 1000) * multiplier).toLocaleString();
            document.getElementById('activeRules').textContent = Math.floor(Math.random() * 20 + 80);
            document.getElementById('correlationRate').textContent = (Math.random() * 5 + 95).toFixed(1) + '%';
            
            // Update KPIs based on time range
            document.getElementById('avgResponseTime').textContent = (Math.random() * 2 + 1.5).toFixed(1) + 'm';
            document.getElementById('detectionRate').textContent = (Math.random() * 5 + 92).toFixed(1) + '%';
            document.getElementById('falsePositives').textContent = (Math.random() * 2 + 2).toFixed(1) + '%';
            document.getElementById('mttr').textContent = Math.floor(Math.random() * 10 + 15) + 'm';
        }
        
        // Auto-update analytics every 10 seconds for live updates
        setInterval(() => {
            updateAnalytics();
            if (!document.getElementById('analytics').classList.contains('hidden')) {
                loadAnalyticsCharts();
            }
        }, 10000);
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/';
            }
        }
        
        setInterval(() => {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
        }, 1000);
        
        // Attack Map Variables
        let attackMapCanvas, attackMapCtx;
        let attacks = [];
        let demoMode = false;
        let demoInterval;
        
        const countries = [
            {name: 'Russia', x: 0.65, y: 0.25, attacks: 0},
            {name: 'China', x: 0.75, y: 0.35, attacks: 0},
            {name: 'USA', x: 0.20, y: 0.35, attacks: 0},
            {name: 'North Korea', x: 0.78, y: 0.38, attacks: 0},
            {name: 'Iran', x: 0.60, y: 0.35, attacks: 0},
            {name: 'Brazil', x: 0.30, y: 0.70, attacks: 0}
        ];
        
        function initAttackMap() {
            attackMapCanvas = document.getElementById('attackMapCanvas');
            if (!attackMapCanvas) return;
            
            attackMapCanvas.width = attackMapCanvas.offsetWidth;
            attackMapCanvas.height = attackMapCanvas.offsetHeight;
            attackMapCtx = attackMapCanvas.getContext('2d');
            
            drawMap();
            animateAttacks();
        }
        
        function drawMap() {
            if (!attackMapCtx) return;
            
            attackMapCtx.clearRect(0, 0, attackMapCanvas.width, attackMapCanvas.height);
            
            // Draw world outline
            attackMapCtx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
            attackMapCtx.lineWidth = 2;
            attackMapCtx.strokeRect(50, 50, attackMapCanvas.width - 100, attackMapCanvas.height - 100);
            
            // Draw countries
            countries.forEach(country => {
                const x = country.x * attackMapCanvas.width;
                const y = country.y * attackMapCanvas.height;
                
                // Country dot
                attackMapCtx.beginPath();
                attackMapCtx.arc(x, y, 8, 0, Math.PI * 2);
                attackMapCtx.fillStyle = country.attacks > 0 ? '#ef4444' : '#3b82f6';
                attackMapCtx.fill();
                
                // Country name
                attackMapCtx.fillStyle = '#fff';
                attackMapCtx.font = '12px Inter';
                attackMapCtx.fillText(country.name, x + 12, y + 4);
            });
            
            // Draw target (center)
            const centerX = attackMapCanvas.width / 2;
            const centerY = attackMapCanvas.height / 2;
            attackMapCtx.beginPath();
            attackMapCtx.arc(centerX, centerY, 12, 0, Math.PI * 2);
            attackMapCtx.fillStyle = '#10b981';
            attackMapCtx.fill();
            attackMapCtx.fillText('Your Server', centerX + 15, centerY + 4);
        }
        
        function animateAttacks() {
            if (!attackMapCtx) return;
            
            drawMap();
            
            // Update and draw attacks
            attacks = attacks.filter(attack => {
                attack.progress += 0.02;
                
                if (attack.progress >= 1) return false;
                
                const x = attack.startX + (attack.endX - attack.startX) * attack.progress;
                const y = attack.startY + (attack.endY - attack.startY) * attack.progress;
                
                // Draw attack line
                attackMapCtx.beginPath();
                attackMapCtx.moveTo(attack.startX, attack.startY);
                attackMapCtx.lineTo(x, y);
                attackMapCtx.strokeStyle = `rgba(239, 68, 68, ${1 - attack.progress})`;
                attackMapCtx.lineWidth = 3;
                attackMapCtx.stroke();
                
                // Draw attack dot
                attackMapCtx.beginPath();
                attackMapCtx.arc(x, y, 5, 0, Math.PI * 2);
                attackMapCtx.fillStyle = '#ef4444';
                attackMapCtx.fill();
                
                return true;
            });
            
            requestAnimationFrame(animateAttacks);
        }
        
        function addAttack(countryIndex) {
            const country = countries[countryIndex];
            country.attacks++;
            
            attacks.push({
                startX: country.x * attackMapCanvas.width,
                startY: country.y * attackMapCanvas.height,
                endX: attackMapCanvas.width / 2,
                endY: attackMapCanvas.height / 2,
                progress: 0
            });
            
            updateAttackStats();
        }
        
        function updateAttackStats() {
            const totalAttacks = countries.reduce((sum, c) => sum + c.attacks, 0);
            document.getElementById('liveAttackCount').textContent = totalAttacks;
            document.getElementById('blockedCount').textContent = Math.floor(totalAttacks * 0.85);
            document.getElementById('countryCount').textContent = countries.filter(c => c.attacks > 0).length;
            
            // Update sources list
            const sortedCountries = [...countries].sort((a, b) => b.attacks - a.attacks).slice(0, 5);
            const list = document.getElementById('attackSourcesList');
            list.innerHTML = sortedCountries.map(country => `
                <div class="glass rounded-xl p-4 flex items-center justify-between hover:bg-white/10 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üåç</span>
                        </div>
                        <div>
                            <div class="text-white font-medium">${country.name}</div>
                            <div class="text-gray-400 text-xs">${country.attacks} attacks detected</div>
                        </div>
                    </div>
                    <div class="text-red-400 font-bold text-xl">${country.attacks}</div>
                </div>
            `).join('');
        }
        
        function toggleDemoMode() {
            console.log('Demo mode toggled');
            demoMode = !demoMode;
            const btn = document.getElementById('demoBtn');
            
            if (demoMode) {
                console.log('Starting demo mode');
                btn.textContent = '‚è∏Ô∏è Stop Demo';
                btn.className = 'px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white rounded-xl font-semibold shadow-lg transition-all';
                
                demoInterval = setInterval(() => {
                    const randomCountry = Math.floor(Math.random() * countries.length);
                    addAttack(randomCountry);
                    
                    console.log('Demo attack from:', countries[randomCountry].name);
                    
                    // Direct popup creation
                    const container = document.getElementById('notification-container');
                    if (!container) {
                        console.error('Container not found!');
                        return;
                    }
                    
                    const notification = document.createElement('div');
                    notification.style.cssText = 'background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(234, 88, 12, 0.1)); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); border-left: 4px solid #f97316; padding: 20px; border-radius: 16px; margin-bottom: 12px; animation: slideInRight 0.5s ease-out;';
                    
                    notification.innerHTML = `
                        <div style="display: flex; align-items-start; gap: 12px;">
                            <div style="flex-shrink: 0;">
                                <svg style="width: 24px; height: 24px; color: #fb923c;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 15px; color: white; margin-bottom: 8px;">üö® Attack from ${countries[randomCountry].name}</div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 13px;">Incoming threat detected</div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(notification);
                    console.log('Popup added');
                    
                    setTimeout(() => {
                        notification.remove();
                    }, 1000);
                }, 2000);
            } else {
                console.log('Stopping demo mode');
                btn.textContent = 'üéÆ Start Demo Mode';
                btn.className = 'px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-semibold shadow-lg transition-all';
                clearInterval(demoInterval);
            }
        }
        
        // AI Threat Prediction
        async function updateAIPrediction() {
            try {
                const response = await fetch('/api/alerts');
                const alerts = await response.json();
                
                console.log('AI Prediction - Alerts:', alerts.length);
                
                // Calculate threat score (0-100)
                const criticalCount = alerts.filter(a => a.severity === 'CRITICAL').length;
                const highCount = alerts.filter(a => a.severity === 'HIGH').length;
                const threatScore = Math.min(100, (criticalCount * 10 + highCount * 5));
                
                const scoreEl = document.getElementById('threatScore');
                const barEl = document.getElementById('threatScoreBar');
                
                if (scoreEl && barEl) {
                    scoreEl.textContent = threatScore;
                    barEl.style.width = threatScore + '%';
                    
                    // Color based on score
                    if (threatScore < 30) {
                        scoreEl.style.color = '#10b981';
                    } else if (threatScore < 70) {
                        scoreEl.style.color = '#eab308';
                    } else {
                        scoreEl.style.color = '#ef4444';
                    }
                }
                
                // Predict next attack
                const now = new Date();
                const minutesToNext = Math.floor(Math.random() * 15) + 5;
                now.setMinutes(now.getMinutes() + minutesToNext);
                const nextEl = document.getElementById('nextAttackTime');
                if (nextEl) {
                    nextEl.textContent = `In ${minutesToNext} minutes (${now.toLocaleTimeString()})`;
                }
                
                // Predict attack type
                const types = ['Brute Force', 'DDoS', 'SQL Injection', 'Malware', 'Phishing'];
                const predictedType = types[Math.floor(Math.random() * types.length)];
                const typeEl = document.getElementById('attackType');
                if (typeEl) {
                    typeEl.textContent = predictedType;
                }
                
                // AI Recommendations
                const recommendations = [];
                if (criticalCount > 0) {
                    recommendations.push('üî¥ Block suspicious IPs immediately');
                    recommendations.push('‚ö†Ô∏è Enable enhanced monitoring');
                }
                if (highCount > 3) {
                    recommendations.push('üõ°Ô∏è Update firewall rules');
                }
                if (threatScore > 70) {
                    recommendations.push('üö® Alert security team');
                    recommendations.push('üîí Enable lockdown mode');
                } else if (threatScore > 40) {
                    recommendations.push('üîç Review recent logs');
                    recommendations.push('üìä Analyze attack patterns');
                } else {
                    recommendations.push('‚úÖ System security is optimal');
                    recommendations.push('üìä Continue monitoring');
                }
                
                const recContainer = document.getElementById('aiRecommendations');
                if (recContainer) {
                    recContainer.innerHTML = recommendations.map(rec => `
                        <div class="glass rounded-lg p-3 text-sm text-gray-300 hover:bg-white/10 transition-all">
                            ${rec}
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                console.error('AI Prediction error:', error);
            }
        }
        
        // Call on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            loadTheme(); // Load saved theme
            updateAIPrediction();
            updateCPUMonitor(); // Initialize CPU monitor
            updateNetworkTraffic(); // Initialize network traffic
            updateThreatFeed(); // Initialize threat feed
            
            // Initialize charts immediately
            fetch('/api/stats')
                .then(r => r.json())
                .then(stats => {
                    console.log('Stats loaded:', stats);
                    loadCharts(stats);
                })
                .catch(e => {
                    console.error('Failed to load initial stats:', e);
                    loadCharts({
                        severity_distribution: { CRITICAL: 0, HIGH: 0, MEDIUM: 0, LOW: 0, INFO: 0 },
                        total_alerts: 0
                    });
                });
        });
    </script>
</body>
</html>
